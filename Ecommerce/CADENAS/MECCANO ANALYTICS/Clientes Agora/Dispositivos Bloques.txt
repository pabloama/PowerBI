// Dispositivos Bloques
let
    Origen = Sql.Database("anl-meccano-sql.database.windows.net", "anlmeccanodw", [Query="#(tab)SET DATEFIRST 1 -- ( Monday )#(lf)#(lf)#(tab)--------------------------------------------------------------------------------------------------------------------------------#(lf)#(tab)declare @year int#(lf)#(tab)declare @yearA1 int#(lf)#(tab)declare @yearA2 int#(lf)#(tab)declare @yearA3 int#(lf)#(tab)declare @yearA4 int#(lf)#(tab)declare @yearA5 int#(lf)#(tab)declare @yearA6 int#(lf)#(tab)declare @FechaIni nvarchar(60), @FechaFin  nvarchar(60)#(lf)#(tab)declare @FechaIniA1 nvarchar(60), @FechaFinA1  nvarchar(60)#(lf)#(tab)declare @FechaIniA2 nvarchar(60), @FechaFinA2  nvarchar(60)#(lf)#(tab)declare @FechaIniA3 nvarchar(60), @FechaFinA3  nvarchar(60)#(lf)#(tab)declare @FechaIniA4 nvarchar(60), @FechaFinA4  nvarchar(60)#(lf)#(tab)declare @FechaIniA5 nvarchar(60), @FechaFinA5  nvarchar(60)#(lf)#(tab)declare @FechaIniA6 nvarchar(60), @FechaFinA6  nvarchar(60)#(lf)#(tab)declare @EJFiscal int, @EJFiscalA1 int, @EJFiscalA2 int#(lf) #(lf)#(tab)set @year = year(sysdatetime())#(lf)#(tab)set @yearA1 = @year-1#(lf)#(tab)set @yearA2 = @year-2#(lf)#(tab)set @yearA3 = @year-3#(lf)#(tab)set @yearA4 = @year-4#(lf)#(tab)set @yearA5 = @year-5#(lf)#(tab)set @yearA6 = @year-6#(lf)#(lf)#(tab)SET @FechaIni = CONCAT(cast(@year as varchar(10)),'-02-01 00:00:00') #(lf)#(tab)SET @FechaFin = CONCAT(cast(sysdatetime() as varchar(10)),' 23:59:59') #(lf)#(lf)#(tab)select @EJFiscal = case when month(getdate()) > 1 then year(getdate()) else year(getdate())-1 end#(lf)#(tab)set @EJFiscalA1 = @EJFiscal-1#(lf)#(tab)set @EJFiscalA2 = @EJFiscal-2#(lf)#(lf)#(tab)SET @FechaIniA1 = CONCAT(cast(@yearA1 as varchar(10)),'-02-01 00:00:00')#(lf)#(tab)select @FechaFinA1 = FECHA_MISMO_DIA_COMERCIAL from dbo_itx.STG_TIEMPO where ID_FECHA = CAST(@FechaFin AS DATE)#(lf)#(lf)#(lf)#(tab)--SET @FechaFinA1 = CONCAT(cast(@year as varchar(10)),'-01-31 23:59:59')#(lf)#(lf)#(tab)SET @FechaIniA2 = CONCAT(cast(@yearA2 as varchar(10)),'-02-01 00:00:00')#(lf)#(tab)SET @FechaFinA2 = CONCAT(cast(@yearA1 as varchar(10)),'-01-31 23:59:59')#(lf)#(lf)#(tab)SET @FechaIniA3 = CONCAT(cast(@yearA3 as varchar(10)),'-02-01 00:00:00')#(lf)#(tab)SET @FechaFinA3 = CONCAT(cast(@yearA2 as varchar(10)),'-01-31 23:59:59')#(lf)#(lf)#(tab)SET @FechaIniA4 = CONCAT(cast(@yearA4 as varchar(10)),'-02-01 00:00:00')#(lf)#(tab)SET @FechaFinA4 = CONCAT(cast(@yearA3 as varchar(10)),'-01-31 23:59:59')#(lf)#(lf)#(tab)SET @FechaIniA5 = CONCAT(cast(@yearA5 as varchar(10)),'-02-01 00:00:00')#(lf)#(tab)SET @FechaFinA5 = CONCAT(cast(@yearA4 as varchar(10)),'-01-31 23:59:59')#(lf)#(lf)#(tab)SET @FechaIniA6 = CONCAT(cast(@yearA6 as varchar(10)),'-02-01 00:00:00')#(lf)#(tab)SET @FechaFinA6 = CONCAT(cast(@yearA5 as varchar(10)),'-01-31 23:59:59')#(lf)#(lf)SELECT ID_PAIS, DESC_PAIS,ID_EJERCICIO_FISCAL,#(lf)#(tab)#(tab)   sum(N_MAILS_WEB_APP_ACT) N_MAILS_WEB_APP_ACT,#(lf)#(tab)#(tab)   sum(N_MAILS_WEB_ACT) N_MAILS_WEB_ACT,#(lf)#(tab)#(tab)   sum(N_MAILS_APP_ACT) N_MAILS_APP_ACT,#(lf)#(tab)#(tab)   sum(N_MAILS_IPOD_ACT) N_MAILS_IPOD_ACT,#(lf)#(tab)#(tab)   sum(N_MAILS_WEB_IPOD_ACT) N_MAILS_WEB_IPOD_ACT,#(lf)#(tab)#(tab)   sum(N_MAILS_APP_IPOD_ACT) N_MAILS_APP_IPOD_ACT,#(lf)#(tab)#(tab)   sum(N_MAILS_WEB_APP_IPOD_ACT) N_MAILS_WEB_APP_IPOD_ACT,#(lf)#(tab)#(tab)   sum(N_MAILS_WEB_APP_ANT) N_MAILS_WEB_APP_ANT,#(lf)#(tab)#(tab)   sum(N_MAILS_WEB_ANT) N_MAILS_WEB_ANT, #(lf)#(tab)#(tab)   sum(N_MAILS_APP_ANT) N_MAILS_APP_ANT,#(lf)#(tab)#(tab)   sum(N_MAILS_IPOD_ANT) N_MAILS_IPOD_ANT,#(lf)#(tab)#(tab)   sum(N_MAILS_WEB_IPOD_ANT) N_MAILS_WEB_IPOD_ANT,#(lf)#(tab)#(tab)   sum(N_MAILS_APP_IPOD_ANT) N_MAILS_APP_IPOD_ANT,#(lf)#(tab)#(tab)   sum(N_MAILS_WEB_APP_IPOD_ANT) N_MAILS_WEB_APP_IPOD_ANT#(lf)#(tab)FROM (#(lf)#(tab)--FY#(lf)#(tab)--PAISES TOTALES#(lf)#(tab)select BASE.ID_PAIS, BASE.DESC_PAIS,BASE.ID_EJERCICIO_FISCAL,#(lf)#(tab)#(tab)   WEB_APP.EMAIL N_MAILS_WEB_APP_ACT,#(lf)#(tab)#(tab)   WEB.EMAIL N_MAILS_WEB_ACT,#(lf)#(tab)#(tab)   APP.EMAIL N_MAILS_APP_ACT,#(lf)#(tab)#(tab)   IPOD.EMAIL N_MAILS_IPOD_ACT,#(lf)#(tab)#(tab)   WEB_IPOD.EMAIL N_MAILS_WEB_IPOD_ACT,#(lf)#(tab)#(tab)   APP_IPOD.EMAIL N_MAILS_APP_IPOD_ACT,#(lf)#(tab)#(tab)   WEB_APP_IPOD.EMAIL N_MAILS_WEB_APP_IPOD_ACT,#(lf)#(tab)#(tab)   0 N_MAILS_WEB_APP_ANT,#(lf)#(tab)#(tab)   0 N_MAILS_WEB_ANT,#(lf)#(tab)#(tab)   0 N_MAILS_APP_ANT,#(lf)#(tab)#(tab)   0 N_MAILS_IPOD_ANT,#(lf)#(tab)#(tab)   0 N_MAILS_WEB_IPOD_ANT,#(lf)#(tab)#(tab)   0 N_MAILS_APP_IPOD_ANT,#(lf)#(tab)#(tab)   0 N_MAILS_WEB_APP_IPOD_ANT#(lf)#(tab)From (#(lf)#(tab)select Pais.ID_PAIS, Pais.DESC_PAIS,T.ID_EJERCICIO_FISCAL #(lf)#(tab)from (select distinct ID_EJERCICIO_FISCAL from dbo_itx.STG_TIEMPO where ID_FECHA = cast(sysdatetime() as date)) T#(lf)#(tab)join (select 1 as ID_PAIS, 'FRANCIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 38 as ID_PAIS, 'MEXICO' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 4 as ID_PAIS, 'ALEMANIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 2 as ID_PAIS, 'BELGICA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 5 as ID_PAIS, 'ITALIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 6 as ID_PAIS, 'UK' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 3 as ID_PAIS, 'HOLANDA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 30 as ID_PAIS, 'RUSIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 11 as ID_PAIS, 'ESPAÑA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 25 as ID_PAIS, 'POLONIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 21 as ID_PAIS, 'TURQUIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 10 as ID_PAIS, 'PORTUGAL' DESC_PAIS) Pais on 1=1) BASE#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES WEB + APP#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIni and FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab) join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) WEB_APP on (BASE.ID_PAIS = WEB_APP.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=WEB_APP.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES SOLO WEB #(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIni and FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab) left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (23,25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) where C.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) WEB on (BASE.ID_PAIS = WEB.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=WEB.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES SOLO APP#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIni and FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab) left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (23,21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) where C.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) APP on (BASE.ID_PAIS = APP.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=APP.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES SOLO IPOD#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIni and FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (23)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab) left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22,25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) where C.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) IPOD on (BASE.ID_PAIS = IPOD.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=IPOD.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES IPOD + WEB#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIni and FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab)  join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO = 23#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) #(lf)#(tab)#(tab)  left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) B on (A.EMAIL = B.EMAIL and A.ID_PAIS = B.ID_PAIS) where B.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) WEB_IPOD on (BASE.ID_PAIS = WEB_IPOD.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=WEB_IPOD.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES IPOD + APP#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIni and FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO = 23#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab)  join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) #(lf)#(tab)#(tab)  left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) B on (A.EMAIL = B.EMAIL and A.ID_PAIS = B.ID_PAIS) where B.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) APP_IPOD on (BASE.ID_PAIS = APP_IPOD.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=APP_IPOD.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES IPOD + APP + WEB#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIni and FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO = 23#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab)  join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) #(lf)#(tab)#(tab)  join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIni and a11.FECHA_PEDIDO <=  @FechaFin#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) B on (A.EMAIL = B.EMAIL and A.ID_PAIS = B.ID_PAIS) #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) WEB_APP_IPOD on (BASE.ID_PAIS = WEB_APP_IPOD.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=WEB_APP_IPOD.ID_EJERCICIO_FISCAL)#(lf)#(tab)--FY-1#(lf)#(tab)UNION #(lf)#(tab)select BASE.ID_PAIS, BASE.DESC_PAIS,BASE.ID_EJERCICIO_FISCAL,#(lf)#(tab)#(tab)   0 N_MAILS_WEB_APP_ACT,#(lf)#(tab)#(tab)   0 N_MAILS_WEB_ACT,#(lf)#(tab)#(tab)   0 N_MAILS_APP_ACT,#(lf)#(tab)#(tab)   0 N_MAILS_IPOD_ACT,#(lf)#(tab)#(tab)   0 N_MAILS_WEB_IPOD_ACT,#(lf)#(tab)#(tab)   0 N_MAILS_APP_IPOD_ACT,#(lf)#(tab)#(tab)   0 N_MAILS_WEB_APP_IPOD_ACT,#(lf)#(tab)#(tab)   WEB_APP.EMAIL N_MAILS_WEB_APP_ANT,#(lf)#(tab)#(tab)   WEB.EMAIL N_MAILS_WEB_ANT,#(lf)#(tab)#(tab)   APP.EMAIL N_MAILS_APP_ANT,#(lf)#(tab)#(tab)   IPOD.EMAIL N_MAILS_IPOD_ANT,#(lf)#(tab)#(tab)   WEB_IPOD.EMAIL N_MAILS_WEB_IPOD_ANT,#(lf)#(tab)#(tab)   APP_IPOD.EMAIL N_MAILS_APP_IPOD_ANT,#(lf)#(tab)#(tab)   WEB_APP_IPOD.EMAIL N_MAILS_WEB_APP_IPOD_ANT#(lf)#(tab)From (#(lf)#(tab)select Pais.ID_PAIS, Pais.DESC_PAIS,T.ID_EJERCICIO_FISCAL #(lf)#(tab)from (select distinct ID_EJERCICIO_FISCAL from dbo_itx.STG_TIEMPO where ID_FECHA = cast(sysdatetime() as date)) T#(lf)#(tab)join (select 1 as ID_PAIS, 'FRANCIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 38 as ID_PAIS, 'MEXICO' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 4 as ID_PAIS, 'ALEMANIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 2 as ID_PAIS, 'BELGICA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 5 as ID_PAIS, 'ITALIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 6 as ID_PAIS, 'UK' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 3 as ID_PAIS, 'HOLANDA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 30 as ID_PAIS, 'RUSIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 11 as ID_PAIS, 'ESPAÑA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 25 as ID_PAIS, 'POLONIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 21 as ID_PAIS, 'TURQUIA' DESC_PAIS#(lf)#(tab)#(tab)  UNION#(lf)#(tab)#(tab)  select 10 as ID_PAIS, 'PORTUGAL' DESC_PAIS) Pais on 1=1) BASE#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES WEB + APP#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL+1 as ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIniA1 and FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab) join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) WEB_APP on (BASE.ID_PAIS = WEB_APP.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=WEB_APP.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES SOLO WEB #(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL+1 as ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIniA1 and FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab) left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (23,25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) where C.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) WEB on (BASE.ID_PAIS = WEB.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=WEB.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES SOLO APP#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL+1 as ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIniA1 and FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab) left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (23,21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) where C.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) APP on (BASE.ID_PAIS = APP.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=APP.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES SOLO IPOD#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL+1 as ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIniA1 and FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (23)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab) left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22,25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) where C.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) IPOD on (BASE.ID_PAIS = IPOD.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=IPOD.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES IPOD + WEB#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL+1 as ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIniA1 and FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab)  join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO = 23#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) #(lf)#(tab)#(tab)  left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) B on (A.EMAIL = B.EMAIL and A.ID_PAIS = B.ID_PAIS) where B.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) WEB_IPOD on (BASE.ID_PAIS = WEB_IPOD.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=WEB_IPOD.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES IPOD + APP#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL+1 as ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIniA1 and FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO = 23#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab)  join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) #(lf)#(tab)#(tab)  left join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) B on (A.EMAIL = B.EMAIL and A.ID_PAIS = B.ID_PAIS) where B.EMAIL is null #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) APP_IPOD on (BASE.ID_PAIS = APP_IPOD.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=APP_IPOD.ID_EJERCICIO_FISCAL)#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)--CLIENTES IPOD + APP + WEB#(lf)#(tab)---------------------------------------------------------#(lf)#(tab)left join (select A.ID_PAIS,A.ID_EJERCICIO_FISCAL+1 as ID_EJERCICIO_FISCAL,count(distinct A.EMAIL) EMAIL #(lf)#(tab)#(tab)  from  (select ID_PAIS, EMAIL,ID_EJERCICIO_FISCAL#(lf)#(tab)#(tab)  from (select a11.ID_PAIS, a12.EMAIL, a11.FECHA_PEDIDO#(lf)#(tab)#(tab)#(tab)#(tab)from dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_st.stg_dim_usuario_ecomm_st#(tab)a12 on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where a11.FECHA_PEDIDO >=   @FechaIniA1 and FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO = 23#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null) a#(lf)#(tab)#(tab)#(tab)#(tab)join dbo_itx.STG_TIEMPO T on cast(a.FECHA_PEDIDO as date) = cast(T.ID_FECHA as date) ) A#(lf)   #(tab)#(tab)  join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (25,26)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) C on (A.EMAIL = C.EMAIL and A.ID_PAIS = C.ID_PAIS) #(lf)#(tab)#(tab)  join  (select a11.ID_PAIS  ID_PAIS,#(tab)a12.EMAIL#(lf)#(tab)#(tab)#(tab)#(tab)from#(tab)dbo_st.stg_ult_estado_linea_pedido_st#(tab)a11#(lf)      #(tab)#(tab)  join#(tab)dbo_st.stg_dim_usuario_ecomm_st#(tab)a12#(tab)  on #(tab)a11.ID_USUARIO_ECOMM = a12.ID_USUARIO_ECOMM#(lf)#(tab)#(tab)#(tab)#(tab)where#(tab)(a11.FECHA_PEDIDO >=  @FechaIniA1 and a11.FECHA_PEDIDO <=  @FechaFinA1#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_CADENA in (6, 15) and a11.ID_CENTRO_COMPRA in (2, 13, 16, 31)#(lf)#(tab)#(tab)#(tab)#(tab)and id_tipo_dispositivo <> 5#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_TIPO_DISPOSITIVO in (21,22)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.ID_PAIS in (1,2,38,4,5,6,3,30,11,25,21,10)#(lf)#(tab)#(tab)#(tab)#(tab)and a11.FECHA_CANCELADO is null)) B on (A.EMAIL = B.EMAIL and A.ID_PAIS = B.ID_PAIS) #(lf)#(tab)#(tab)  group by A.ID_PAIS,A.ID_EJERCICIO_FISCAL) WEB_APP_IPOD on (BASE.ID_PAIS = WEB_APP_IPOD.ID_PAIS and BASE.ID_EJERCICIO_FISCAL=WEB_APP_IPOD.ID_EJERCICIO_FISCAL)#(lf)#(tab)) TOTAL group by ID_PAIS, DESC_PAIS,ID_EJERCICIO_FISCAL ", CreateNavigationProperties=false, CommandTimeout=#duration(0, 10, 0, 0)])
in
    Origen