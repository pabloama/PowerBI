// Stock_Insuficiente_INDOM_1
let
    Source = DB2.Database("ieecdb2v1:50000", "inditex", [HierarchicalNavigation=true, Implementation="IBM", Query="WITH TEMPCLI AS (#(lf)SELECT     #(lf)    CANTIDAD_SOLICITADA,#(lf)    PARTNUMBER, #(lf)    CANTIDAD_SEPARADA, #(lf)    RESOLUCION_AUTOMATICA,#(lf)    ID_CAMBIO_ESTADO_LINEA_PEDIDO,#(lf)    ID_MOTIVO_INVENTARIO_INSUFICIENTE#(lf)FROM INDOM_ITX.CAMBIO_LINEA_PEDIDO_INVENTARIO_INSUFICIENTE#(lf)WHERE CANTIDAD_SOLICITADA <> CANTIDAD_SEPARADA#(lf))#(lf)SELECT #(lf)    p.COD_PEDIDO_WCS,#(lf)    ee.DESCRIPCION AS TIENDA_ONLINE, #(lf)    p.FECHA_ALTA AS FECHA_PEDIDO, #(lf)    celp.FECHA_HORA_NOTIFICADA AS FECHA_INSUFICIENTE, #(lf)    os.COD_ORIGEN_STOCK_WCS AS ORIGEN_STOCK, #(lf)    s.CODIGO_RASTREO AS ID_SUBPEDIDO,#(lf)    cli.PARTNUMBER, #(lf)    cli.CANTIDAD_SOLICITADA, #(lf)    cli.CANTIDAD_SEPARADA, #(lf)    cli.RESOLUCION_AUTOMATICA,#(lf)    ep.DESCRIPCION AS ESTADO_PEDIDO,#(lf)    elp.DESCRIPCION AS ESTADO_LINEA_PEDIDO,#(lf)    CASE#(lf)        WHEN cli.ID_MOTIVO_INVENTARIO_INSUFICIENTE = 1#(lf)            THEN 'ALMACEN'#(lf)        ELSE 'INDOM'#(lf)        END AS DECLARACION_INSUFICIENTE#(lf)FROM TEMPCLI cli#(lf)    INNER JOIN INDOM_ITX.CAMBIO_ESTADO_LINEA_PEDIDO celp #(lf)        ON cli.ID_CAMBIO_ESTADO_LINEA_PEDIDO = celp.ID_CAMBIO_ESTADO_LINEA_PEDIDO#(lf)            AND celp.FECHA_HORA_NOTIFICADA >= CURRENT TIMESTAMP - 60 DAYS#(lf)    INNER JOIN INDOM_ITX.LINEA_PEDIDO lp #(lf)        ON celp.ID_LINEA_PEDIDO = lp.ID_LINEA_PEDIDO#(lf)    INNER JOIN INDOM_ITX.ESTADO_LINEA_PEDIDO elp #(lf)        ON lp.ID_ESTADO_LINEA_PEDIDO = elp.ID_ESTADO_LINEA_PEDIDO#(lf)    INNER JOIN INDOM_ITX.SUBPEDIDO s #(lf)        ON lp.ID_SUBPEDIDO = s.ID_SUBPEDIDO#(lf)    INNER JOIN INDOM_ITX.ORIGEN_STOCK os #(lf)        ON os.ID_ORIGEN_STOCK = s.ID_ORIGEN_STOCK #(lf)            AND os.ID_CADENA = 4 -- Bershka#(lf)    INNER JOIN INDOM_ITX.PEDIDO p #(lf)        ON p.ID_PEDIDO = s.ID_PEDIDO#(lf)            AND p.FECHA_ALTA >= CURRENT TIMESTAMP -  60 DAYS#(lf)    INNER JOIN INDOM_ITX.ESTADO_PEDIDO ep #(lf)        ON ep.iD_ESTADO_PEDIDO = p.ID_ESTADO_PEDIDO#(lf)    INNER JOIN INDOM_ITX.ENTIDAD_ECOMMERCE ee #(lf)        ON p.ID_ENTIDAD_ECOMMERCE = ee.ID_ENTIDAD_ECOMMERCE#(lf)WITH UR;", CommandTimeout=#duration(0, 7, 0, 0)])
in
    Source