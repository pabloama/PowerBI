// Zara_SINT_LASTMONTH
let
    Source = DB2.Database("axindb2tndg6v1:50000", "inditex", [HierarchicalNavigation=true, Implementation="IBM", Query="-- IBM DB2 - LOGISTICS TIENDA ENTORNO PRO - OMNICHANNEL - ZARA - SINT - LAST MONTH#(lf)WITH PED_PICKING AS (#(lf)#(tab)SELECT #(lf)#(tab)#(tab)p.ID_PEDIDO, #(lf)#(tab)#(tab)MIN(p.FECHA_ALTA) AS FECHA_INICIO_PICKING,#(lf)#(tab)#(tab)MAX(p.FECHA_MODIFICACION) AS FECHA_FIN_PICKING#(lf)#(tab)FROM ECLOG_ITX_TND.OLEADA_PICKING_IPOD o#(lf)#(tab)INNER JOIN ECLOG_ITX_TND.OLEADA_PICKING_IPOD_PEDIDO p #(lf)#(tab)#(tab)ON o.ID_OLEADA_PICKING_IPOD = p.ID_OLEADA_PICKING_IPOD #(lf)#(tab)#(tab)#(tab)AND ID_ESTADO_OLEADA_PICKING = 3#(lf)#(tab)WHERE #(lf)#(tab)#(tab)p.FECHA_ALTA >= (CURRENT_DATE - 2 MONTH)#(lf)#(tab)GROUP BY #(lf)#(tab)#(tab)p.ID_PEDIDO#(lf))#(lf)SELECT#(lf)    zz.PAIS AS COD_PAIS,#(lf)#(tab)zz.ID_LOCALIZACION AS STORE_CODE,#(lf)#(tab)zz.DESCRIPCION AS STORE,#(lf)#(tab)zz.COD_PEDIDO_WCS AS ORDER_CODE,#(lf)#(tab)zz.ARTICULOS AS UNITS,#(lf)#(tab)zz.FECHA_HORA_COMPRA_LOCAL AS LOCAL_PURCHASE_DATE,#(lf)#(tab)FROM_UTC_TIMESTAMP(TIMESTAMP(zz.FECHA_HORA_NOTIFICACION), zz.HUSO_HORARIO) AS LOCAL_RECEPTION_DATE,#(lf)#(tab)FROM_UTC_TIMESTAMP(TO_UTC_TIMESTAMP(TIMESTAMP(zz.FECHA_EMPAQUETADO), 'Europe/Madrid'), zz.HUSO_HORARIO) AS LOCAL_PACKING_DATE,#(lf)#(tab)FROM_UTC_TIMESTAMP(TO_UTC_TIMESTAMP(TIMESTAMP(zz.FECHA_EXP), 'Europe/Madrid'), zz.HUSO_HORARIO) AS LOCAL_EXPEDITION_DATE,#(lf)#(tab)FROM_UTC_TIMESTAMP(TO_UTC_TIMESTAMP(TIMESTAMP(zz.FECHA_DESESTIMACION), 'Europe/Madrid'), zz.HUSO_HORARIO) AS LOCAL_REJECTION_DATE,#(lf)#(tab)FROM_UTC_TIMESTAMP(TO_UTC_TIMESTAMP(TIMESTAMP(zz.FECHA_CANCELACION), 'Europe/Madrid'), zz.HUSO_HORARIO) AS LOCAL_CANCELLATION_DATE,#(lf)#(tab)FROM_UTC_TIMESTAMP(TO_UTC_TIMESTAMP(TIMESTAMP(zz.FECHA_INICIO_PICKING), 'Europe/Madrid'), zz.HUSO_HORARIO) AS LOCAL_PICKING_START_DATE,#(lf)#(tab)FROM_UTC_TIMESTAMP(TO_UTC_TIMESTAMP(TIMESTAMP(zz.FECHA_FIN_PICKING), 'Europe/Madrid'), zz.HUSO_HORARIO) AS LOCAL_PICKING_END_DATE,#(lf)#(tab)FROM_UTC_TIMESTAMP(TIMESTAMP(zz.FECHA_HORA_MAXIMA_ESTIMADA_ENTREGA_UTC), zz.HUSO_HORARIO) AS LOCAL_MAX_ESTIM_ENTREGA_DATE,#(lf)#(tab)zz.FECHA_HORA_MAXIMA_PREPARACION,#(lf)#(tab)zz.NOMBRE_ESTADO_PEDIDO AS STATUS,#(lf)#(tab)COALESCE(zz.RAZON_ANULACION,'') AS CANCEL_REASON,#(lf)    CASE#(lf)        WHEN zz.ID_ESTADO_PEDIDO = 1#(lf)        THEN 'Received'#(lf)        ELSE#(lf)            CASE#(lf)                WHEN zz.ID_ESTADO_PEDIDO IN (2,#(lf)                                             4,#(lf)                                             40 ,#(lf)                                             3)#(lf)                THEN 'Picking process'#(lf)                ELSE#(lf)                    CASE#(lf)                        WHEN zz.ID_ESTADO_PEDIDO IN (7,#(lf)                                                     8,#(lf)                                                     9)#(lf)                        THEN 'Packing process'#(lf)                        ELSE#(lf)                            CASE#(lf)                                WHEN zz.ID_ESTADO_PEDIDO IN (10)#(lf)                                THEN 'Packed'#(lf)                                ELSE#(lf)                                    CASE#(lf)                                        WHEN zz.ID_ESTADO_PEDIDO IN (12)#(lf)                                        THEN 'Shipped'#(lf)                                        ELSE#(lf)                                            CASE#(lf)                                                WHEN zz.ID_ESTADO_PEDIDO = 31#(lf)                                                OR  (zz.ID_ESTADO_PEDIDO = 32#(lf)                                                    AND zz.ID_RAZON_ANULACION_PEDIDO = 5)#(lf)                                                THEN 'Cancelled'#(lf)                                                ELSE 'Rejected'#(lf)                                            END#(lf)                                    END#(lf)                            END#(lf)                    END#(lf)            END#(lf)    END              AS STATUS_EQUIVALENTE,#(lf)    zz.TRANSPORTISTA AS COURIER,#(lf)    CASE#(lf)        WHEN zz.LOCALIZACION_ENTREGA IS NULL#(lf)        THEN 'Domicilio'#(lf)        ELSE CHAR(zz.LOCALIZACION_ENTREGA)#(lf)    END AS LOCALIZACION_ENTREGA,#(lf)    CASE#(lf)        WHEN zz.ID_METODO_TRANSPORTE IN (6,#(lf)                                         7)#(lf)        THEN 'Sí'#(lf)        ELSE 'No'#(lf)    END AS DROP_POINT,#(lf)    CASE#(lf)        WHEN zz.ATRIBUTOS = 4096#(lf)        THEN 'Sí'#(lf)        ELSE 'No'#(lf)    END             AS FAST_SINT,#(lf)    zz.CUENTA_CAJAS AS BUNDLES,#(lf)    (#(lf)        SELECT#(lf)            LISTAGG(TCE.DESCRIPCION, '; ')#(lf)        FROM#(lf)            ECLOG_ITX_TND.TIPO_CAJA_ECOMMERCE tce#(lf)        INNER JOIN#(lf)            ECLOG_ITX_TND.CAJA_PEDIDO cp#(lf)        ON#(lf)            cp.ID_TIPO_CAJA_ECOMMERCE = tce.ID_TIPO_CAJA_ECOMMERCE#(lf)        AND cp.ID_PEDIDO = zz.ID_PEDIDO#(lf)        GROUP BY#(lf)            cp.ID_PEDIDO WITH UR ) AS BUNDLES_SIZE,#(lf)    zz.IMPORTE_TOTAL               AS TOTAL_IMPORT,#(lf)    zz.MONEDA                      AS CURRENCY,#(lf)    zz.ID_TIPO_OPERATIVA_PEDIDO,#(lf)#(tab)zz.BLOQUEO_PEDIDO_TRANSPORTISTA,#(lf)   #(tab)zz.BLOQUEO_DOCUMENTACION#(lf)FROM (#(lf)        SELECT#(lf)            sub.ID_PEDIDO,#(lf)            sub.ID_SUBPEDIDO,#(lf)            ped.FECHA_HORA_COMPRA AS FECHA_HORA_COMPRA,#(lf)            ped.ID_ESTADO_PEDIDO,#(lf)            ep.DESCRIPCION      AS NOMBRE_ESTADO_PEDIDO,#(lf)            rap.deScripcion     AS RAZON_ANULACION,#(lf)            ped.NUMERO_UNIDADES AS ARTICULOS,#(lf)            ped.COD_PEDIDO_WCS,#(lf)            ROW_NUMBER() OVER( ORDER BY ped.FECHA_MODIFICACION DESC, ped.FECHA_HORA_COMPRA_LOCAL#(lf)            DESC ) AS RN,#(lf)            ll.DESCRIPCION,#(lf)            ll.ID_LOCALIZACION,#(lf)            ped.FECHA_HORA_COMPRA_LOCAL,#(lf)            ped.FECHA_HORA_NOTIFICACION,#(lf)            ped.FECHA_MODIFICACION,#(lf)            ped.ID_RAZON_ANULACION_PEDIDO,#(lf)            gd.ID_GRUPO_DISTRIBUCION,#(lf)            e.FECHA_ALTA AS FECHA_EXPEDICION,#(lf)            ll.HUSO_HORARIO,#(lf)            gd.ID_PAIS AS PAIS,#(lf)            ped.IMPORTE_TOTAL,#(lf)            ped.MONEDA,#(lf)            ped.ID_TIPO_OPERATIVA_PEDIDO,#(lf)            et.NOMBRE                   AS TRANSPORTISTA,#(lf)            ci.DESCRIPCION              AS NOMBRE_CADENA,#(lf)            ped.ID_LOCALIZACION_ENTREGA AS LOCALIZACION_ENTREGA,#(lf)            ped.ID_METODO_TRANSPORTE,#(lf)            ped.ATRIBUTOS,#(lf)            ped.FECHA_HORA_MAXIMA_PREPARACION AS FECHA_HORA_MAXIMA_PREPARACION,#(lf)#(tab)#(tab)#(tab)ped.FECHA_HORA_MAXIMA_ESTIMADA_ENTREGA_UTC,#(lf)            COUNT(DISTINCT cp.ID_CAJA_PEDIDO) AS CUENTA_CAJAS,#(lf)            cepemp.FECHA_HORA_SISTEMA         AS FECHA_EMPAQUETADO,#(lf)            cepexp.FECHA_HORA_SISTEMA         AS FECHA_EXP,#(lf)            cepfd.FECHA_HORA_SISTEMA          AS FECHA_DESESTIMACION,#(lf)            cepfc.FECHA_HORA_SISTEMA          AS FECHA_CANCELACION,#(lf)            FECHA_INICIO_PICKING,#(lf)            FECHA_FIN_PICKING,#(lf)#(tab)#(tab)#(tab)ped.BLOQUEO_PEDIDO_TRANSPORTISTA,#(lf)#(tab)#(tab)#(tab)ped.BLOQUEO_DOCUMENTACION#(lf)        FROM#(lf)            ECLOG_ITX_TND.SUBPEDIDO sub#(lf)        INNER JOIN#(lf)            ECLOG_ITX_TND.LOCALIZACION_GRUPO_DISTRIBUCION lgd#(lf)        ON#(lf)            lgd.ID_LOCALIZACION = sub.ID_LOCALIZACION -- AND lgd.ID_GRUPO_DISTRIBUCION = 214#(lf)        INNER JOIN#(lf)            ECLOG_ITX_TND.PEDIDO ped#(lf)        ON#(lf)        sub.FECHA_ALTA >= (CURRENT_DATE - 1 MONTH)#(lf)        AND sub.FECHA_ALTA < (CURRENT_DATE + 2 DAY)#(lf)        AND ped.FECHA_ALTA >= (CURRENT_DATE - 1 MONTH)#(lf)        AND ped.FECHA_ALTA < (CURRENT_DATE + 2 DAY)#(lf)        AND ped.ID_PEDIDO = sub.ID_PEDIDO#(lf)        AND ped.ID_TIPO_OPERATIVA_PEDIDO IN (2,#(lf)                                             20,#(lf)                                             21,#(lf)                                             22)#(lf)        AND (#(lf)                ped.ID_RAZON_ANULACION_PEDIDO IS NULL#(lf)            OR  ped.ID_RAZON_ANULACION_PEDIDO IN (1,#(lf)                                                  2,#(lf)                                                  3,#(lf)                                                  6,#(lf)                                                  5,#(lf)                                                  7,#(lf)                                                  8,#(lf)                                                  10,#(lf)                                                  101))#(lf)        AND (#(lf)                ped.PENDIENTE_ALARMAR IS NULL#(lf)            OR  ped.PENDIENTE_ALARMAR IN (1,0))#(lf)        AND ped.ID_ESTADO_PEDIDO IN (1,#(lf)                                     2,#(lf)                                     4,#(lf)                                     3,#(lf)                                     32,#(lf)                                     12,#(lf)                                     7,#(lf)                                     8,#(lf)                                     9,#(lf)                                     10,#(lf)                                     40,#(lf)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab) 5,#(lf)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab) 6,#(lf)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab)#(tab) 0)#(lf)        AND sub.ID_LOCALIZACION = lgd.ID_LOCALIZACION#(lf)        INNER JOIN#(lf)            ECLOG_ITX_TND.ESTADO_PEDIDO ep#(lf)        ON#(lf)            ep.ID_ESTADO_PEDIDO = ped.ID_ESTADO_PEDIDO#(lf)        LEFT JOIN#(lf)            ECLOG_ITX_TND.RAZON_ANULACION_PEDIDO rap#(lf)        ON#(lf)            rap.ID_RAZON_ANULACION_PEDIDO = ped.ID_RAZON_ANULACION_PEDIDO#(lf)        --INNER JOIN ECLOG_ITX_TND.LINEA_PEDIDO lin ON lin.ID_SUBPEDIDO = sub.ID_SUBPEDIDO#(lf)        INNER JOIN#(lf)            ECLOG_ITX_TND.GRUPO_DISTRIBUCION gd#(lf)        ON#(lf)            gd.ID_GRUPO_DISTRIBUCION = ped.ID_GRUPO_DISTRIBUCION#(lf)        INNER JOIN#(lf)            MAESTROS.LOCALIZACION LL#(lf)        ON#(lf)            ll.ID_LOCALIZACION = sub.ID_LOCALIZACION#(lf)        INNER JOIN#(lf)            ECLOG_ITX_TND.EMPRESA_TRANSPORTE et#(lf)        ON#(lf)            et.ID_EMPRESA_TRANSPORTE = ped.ID_EMPRESA_TRANSPORTE_ENTREGA#(lf)        --LEFT JOIN ECLOG_ITX_TND.CAJA_PEDIDO_LINEA_PEDIDO cp ON cp.ID_LINEA_PEDIDO = lin.id_LINEA_PEDIDO#(lf)        LEFT JOIN ECLOG_ITX_TND.CAJA_PEDIDO cp ON cp.ID_PEDIDO = ped.ID_PEDIDO#(lf)        INNER JOIN#(lf)            ECLOG_ITX_TND.CADENA_INFORMACION ci#(lf)        ON#(lf)            ci.id_cadena = gd.id_cadena#(lf)        LEFT JOIN#(lf)            ECLOG_ITX_TND.EXPEDICION e#(lf)        ON#(lf)            e.ID_EXPEDICION = ped.ID_EXPEDICION#(lf)        LEFT JOIN#(lf)            ECLOG_ITX_TND.CAMBIO_ESTADO_PEDIDO cepemp#(lf)        ON#(lf)            cepemp.ID_PEDIDO = ped.ID_PEDIDO#(lf)        AND cepemp.ID_ESTADO_PEDIDO IN (10)#(lf)        LEFT JOIN#(lf)            ECLOG_ITX_TND.CAMBIO_ESTADO_PEDIDO cepexp#(lf)        ON#(lf)            cepexp.ID_PEDIDO = ped.ID_PEDIDO#(lf)        AND cepexp.ID_ESTADO_PEDIDO IN (12)#(lf)        LEFT JOIN#(lf)            ECLOG_ITX_TND.CAMBIO_ESTADO_PEDIDO cepfd#(lf)        ON#(lf)            cepfd.ID_PEDIDO = ped.ID_PEDIDO#(lf)        AND cepfd.ID_ESTADO_PEDIDO = 32#(lf)        AND ped.ID_RAZON_ANULACION_PEDIDO != 5#(lf)        LEFT JOIN#(lf)            ECLOG_ITX_TND.CAMBIO_ESTADO_PEDIDO cepfc#(lf)        ON#(lf)            cepfc.ID_PEDIDO = ped.ID_PEDIDO#(lf)        AND cepfc.ID_ESTADO_PEDIDO = 32#(lf)        AND ped.ID_RAZON_ANULACION_PEDIDO = 5#(lf)        LEFT JOIN PED_PICKING#(lf)        ON#(lf)            PED_PICKING.ID_PEDIDO = ped.ID_PEDIDO#(lf)        WHERE#(lf)            1 = 1#(lf)        GROUP BY#(lf)            sub.ID_SUBPEDIDO,#(lf)            sub.CODIGO_UNIFICADO,#(lf)            ped.FECHA_HORA_COMPRA,#(lf)            ped.FECHA_HORA_MAXIMA_PICKING,#(lf)            ped.ID_ESTADO_PEDIDO,#(lf)            ep.DESCRIPCION,#(lf)            rap.DESCRIPCION,#(lf)            ped.ID_TIPO_DIVISION_PEDIDO,#(lf)            sub.NUMERO_IMPRESIONES_PICKING,#(lf)            ped.FECHA_HORA_EXPIRACION,#(lf)            sub.ID_PEDIDO,#(lf)            ped.COD_PEDIDO_WCS,#(lf)            ll.DESCRIPCION,#(lf)            ll.ID_LOCALIZACION,#(lf)            ped.FECHA_HORA_COMPRA_LOCAL,#(lf)            ped.FECHA_HORA_NOTIFICACION,#(lf)            ped.FECHA_MODIFICACION,#(lf)            ped.ID_RAZON_ANULACION_PEDIDO,#(lf)            gd.ID_GRUPO_DISTRIBUCION,#(lf)            gd.DIFERENCIA_HORAS,#(lf)            e.FECHA_ALTA,#(lf)            ll.HUSO_HORARIO,#(lf)            gd.ID_PAIS,#(lf)            ped.IMPORTE_TOTAL,#(lf)            ped.MONEDA,#(lf)            ped.ID_TIPO_OPERATIVA_PEDIDO,#(lf)            et.NOMBRE,#(lf)            ci.DESCRIPCION,#(lf)            ped.ID_LOCALIZACION_ENTREGA,#(lf)            ped.ID_METODO_TRANSPORTE,#(lf)            ped.ATRIBUTOS,#(lf)            ped.FECHA_HORA_MAXIMA_PREPARACION,#(lf)#(tab)#(tab)#(tab)ped.FECHA_HORA_MAXIMA_ESTIMADA_ENTREGA_UTC,#(lf)            ped.BLOQUEO_PEDIDO_TRANSPORTISTA,#(lf)            ped.BLOQUEO_DOCUMENTACION,#(lf)            ped.NUMERO_UNIDADES,#(lf)#(tab)#(tab)#(tab)ped.BLOQUEO_PEDIDO_TRANSPORTISTA,#(lf)#(tab)#(tab)#(tab)ped.BLOQUEO_DOCUMENTACION,#(lf)            cepemp.FECHA_HORA_SISTEMA,#(lf)            cepexp.FECHA_HORA_SISTEMA,#(lf)            cepfd.FECHA_HORA_SISTEMA,#(lf)            cepfc.FECHA_HORA_SISTEMA,#(lf)            FECHA_INICIO_PICKING,#(lf)            FECHA_FIN_PICKING ) AS zz#(lf)WHERE#(lf)    1 = 1#(lf)WITH UR", CommandTimeout=#duration(0, 7, 0, 0)])
in
    Source