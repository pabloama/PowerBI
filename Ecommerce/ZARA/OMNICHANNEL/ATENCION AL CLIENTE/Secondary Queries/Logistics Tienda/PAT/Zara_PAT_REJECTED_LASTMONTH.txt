// Zara_PAT_REJECTED_LASTMONTH
let
    Source = DB2.Database("axindb2tndg6v1:50000", "inditex", [HierarchicalNavigation=true, Implementation="IBM", Query="-- IBM DB2 - REPLICA LOGISTICS TIENDA - OPERATIVA PAT - UNIDADES DESESTIMADAS - ZARA - FY2020#(lf)SELECT#(lf)#(tab)--p.FECHA_HORA_COMPRA_LOCAL AS fecha_hora_compra_local,#(lf)#(tab)DATE(p.FECHA_HORA_COMPRA_LOCAL) AS fecha_compra_local,#(lf)#(tab)gd.ID_PAIS AS id_pais,#(lf)#(tab)sp.ID_LOCALIZACION AS cod_tienda,#(lf)#(tab)SUM(lpi.CANTIDAD_INCIDENCIA) AS uds_desestimadas#(lf)FROM ECLOG_ITX_TND.PEDIDO p #(lf)INNER JOIN ECLOG_ITX_TND.SUBPEDIDO sp#(lf)#(tab)ON (p.ID_PEDIDO = sp.ID_PEDIDO)#(lf)INNER JOIN ECLOG_ITX_TND.LINEA_PEDIDO lp #(lf)#(tab)ON (lp.ID_SUBPEDIDO = sp.ID_SUBPEDIDO)#(lf)INNER JOIN ECLOG_ITX_TND.LINEA_PEDIDO_INCIDENCIA lpi#(lf)#(tab)ON (lpi.ID_PEDIDO = p.ID_PEDIDO)#(lf)#(tab)#(tab)AND (lpi.COD_LINEA_PEDIDO_WCS = lp.COD_LINEA_PEDIDO_WCS)#(lf)INNER JOIN ECLOG_ITX_TND.LOCALIZACION_GRUPO_DISTRIBUCION loc #(lf)#(tab)ON (loc.ID_LOCALIZACION = sp.ID_LOCALIZACION)#(lf)INNER JOIN ECLOG_ITX_TND.GRUPO_DISTRIBUCION gd #(lf)#(tab)ON (gd.ID_GRUPO_DISTRIBUCION = loc.ID_GRUPO_DISTRIBUCION)#(lf)WHERE#(lf)#(tab)p.FECHA_ALTA >= (CURRENT_DATE - 2 MONTH)#(lf)#(tab)AND p.FECHA_HORA_COMPRA_LOCAL BETWEEN (CURRENT_DATE - 1 MONTH)#(lf)#(tab)#(tab)AND (CURRENT_DATE + 1)#(lf)#(tab)AND gd.ID_CADENA IN (1, 16) -- ZARA Y ZARA SUR#(lf)#(tab)AND sp.ID_ESTADO_SUBPEDIDO = 32#(lf)#(tab)AND lpi.ID_TIPO_INCIDENCIA_LINEA_PEDIDO IN (31, 32, 33)#(lf)#(tab)AND p.ID_TIPO_OPERATIVA_PEDIDO = 3 -- PAT#(lf)GROUP BY#(lf)#(tab)--p.FECHA_HORA_COMPRA_LOCAL,#(lf)#(tab)DATE(p.FECHA_HORA_COMPRA_LOCAL),#(lf)#(tab)gd.ID_PAIS,#(lf)#(tab)sp.ID_LOCALIZACION#(lf)WITH UR;", CommandTimeout=#duration(0, 7, 0, 0)])
in
    Source