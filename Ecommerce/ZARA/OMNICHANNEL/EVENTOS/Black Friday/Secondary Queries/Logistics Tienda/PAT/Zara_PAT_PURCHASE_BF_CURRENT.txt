// Zara_PAT_PURCHASE_BF_CURRENT
let
    Source = DB2.Database("axindb2tndg6v1:50000", "inditex", [HierarchicalNavigation=true, Implementation="IBM", Query="-- IBM DB2 - REPLICA LOGISTICS TIENDA - OPERATIVA PAT - UNIDADES COMPRADAS - ZARA - LAST MONTH#(lf)SELECT#(lf)#(tab)--p.FECHA_HORA_COMPRA_LOCAL AS fecha_hora_compra_local,#(lf)#(tab)DATE(p.FECHA_HORA_COMPRA_LOCAL) AS fecha_compra_local,#(lf)#(tab)gd.ID_PAIS AS id_pais,#(lf)#(tab)sp.ID_LOCALIZACION AS cod_tienda,#(lf)#(tab)SUM(p.NUMERO_UNIDADES) AS uds_compradas#(lf)FROM ECLOG_ITX_TND.PEDIDO p #(lf)INNER JOIN ECLOG_ITX_TND.SUBPEDIDO sp#(lf)#(tab)ON (p.ID_PEDIDO = sp.ID_PEDIDO)#(lf)INNER JOIN ECLOG_ITX_TND.LOCALIZACION_GRUPO_DISTRIBUCION loc #(lf)#(tab)ON (loc.ID_LOCALIZACION = sp.ID_LOCALIZACION)#(lf)INNER JOIN ECLOG_ITX_TND.GRUPO_DISTRIBUCION gd #(lf)#(tab)ON (gd.ID_GRUPO_DISTRIBUCION = loc.ID_GRUPO_DISTRIBUCION)#(lf)WHERE#(lf)#(tab)p.FECHA_ALTA >= '2020-10-01 00:00:00.000'#(lf)#(tab)AND p.FECHA_HORA_COMPRA_LOCAL >= '2020-11-26 00:00:00.000'#(lf)#(tab)#(tab)AND p.FECHA_HORA_COMPRA_LOCAL < '2020-12-27 00:00:00.000'#(lf)#(tab)AND gd.ID_CADENA IN (1, 16) -- ZARA Y ZARA SUR#(lf)#(tab)AND p.ID_ESTADO_PEDIDO IN (0, 1, 2, 3, 4, 5, 6, 40)#(lf)#(tab)AND p.ID_TIPO_OPERATIVA_PEDIDO = 3 -- PAT#(lf)GROUP BY#(lf)#(tab)--p.FECHA_HORA_COMPRA_LOCAL,#(lf)#(tab)DATE(p.FECHA_HORA_COMPRA_LOCAL),#(lf)#(tab)gd.ID_PAIS,#(lf)#(tab)sp.ID_LOCALIZACION#(lf)WITH UR;", CommandTimeout=#duration(0, 7, 0, 0)])
in
    Source